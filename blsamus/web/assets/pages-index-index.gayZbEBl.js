import{_ as e,r as a,i as l,a as t,o as s,b as o,c as n,d as i,e as r,w as u,f as d,g as m,h as _,j as c,k as g,l as p,m as f,n as b,p as v,q as y,s as h,t as k,u as C,v as w,x as B,y as V,z as q,A as x,B as A,C as I,D as U,E as K,S as z}from"./index-BshtbQ0O.js";const S=e({__name:"index",setup(e){const S=a(!1),M=a({img_name:"",img_path_relative:"",img_size_bytes:0,img_dimensions:[0,0],img_format:"png",task:"segmentation",dataset_name:"KidneyUS",organ:"Kidney",data_partition_group:"public_all",mask_name:"",mask_path_relative:"",seg_target_info:{},class_label_index:0,class_label_name:"",mask_path_absolute:""}),F=uni.$config,P=l("envType"),j=F[P].API_BASE,G=j+"segment2/",T=j+"random_sample/",$=j+"static/",E=j+"staticout/",N=t({img_name:"",img_path_relative:"",img_size_bytes:0,img_dimensions:[0,0],img_format:"png",task:"segmentation",dataset_name:"KidneyUS",organ:"Kidney",data_partition_group:"public_all",mask_name:"",mask_path_relative:"",seg_target_info:{},class_label_index:0,class_label_name:""});s(()=>{console.log("onMounted",P,"href",G)}),o(()=>{console.log("onActivated")}),a([{value:"png",label:"PNG"},{value:"jpg",label:"JPG"},{value:"dicom",label:"DICOM"},{value:"nii",label:"NIfTI"}]);const O=a([{value:"BUS-BRA",label:"乳腺"},{value:"CAMUS",label:"心脏"},{value:"Fetal_HC",label:"胎儿头部"},{value:"KidneyUS",label:"肾脏"},{value:"private_Kidney",label:"甲状腺"}]),D=a([{value:"private_Appendix",label:"阑尾"},{value:"BUS-BRA",label:"乳腺"},{value:"Fatty-Liver",label:"脂肪肝"},{value:"private_Breast_Luminal",label:"乳腺管腔"}]);function R(e){let a=e;return O.value.forEach(function(l){e!==l.value||(a=l.label)},this),a}a([{value:"public_all",label:"公开全集[public_all]"},{value:"train",label:"训练集[train]"},{value:"val",label:"验证集[val]"},{value:"test",label:"测试集[test]"},{value:"private",label:"私有数据"}]);const J=t({img_name:[{required:!0,message:"图像名称不能为空",trigger:"blur"}],img_format:[{required:!0,pattern:/^(png|jpg|jpeg|dicom|nii)$/i,message:"仅支持PNG/JPG/DICOM/NIfTI格式",trigger:"change"}],task:[{required:!0,message:"请选择任务类型",trigger:"change"}],dataset_name:[{required:!0,message:"器官数据集名称不能为空",trigger:"blur"}],organ:[{required:!0,message:"请选择器官类型",trigger:"change"}]});a(!1),t({key:"",value:""});const L=a(null);a(null);const H=e=>{console.log("groupChangeTask",e),N.dataset_name="segmentation"===e?"KidneyUS":"private_Appendix",W()},W=()=>{console.log("clearImage"),N.img_name="",N.img_dimensions=[],N.img_path_relative="",N.img_size_bytes=""},Q=async()=>{try{if(await L.value.validate(),N.img_dimensions[0]<=0)return void q({title:"请点随机影响，获取一张图片",icon:"error",duration:2e3});x({title:"提交中...",mask:!0}),console.log("data",G,N),A({url:G,method:"POST",data:N}).then(e=>{console.log("request success",e),200==e.statusCode?(q({title:"返回数据成功",icon:"success",duration:2e3}),M.value=e.data||{},S.value=!0):q({title:"返回数据异常",icon:"error",duration:2e3})}).catch(e=>{console.log("request fail",e),I({content:"请求出错，请稍后再试，谢谢！",showCancel:!1})}).finally(()=>{U()})}catch(e){console.log("表单验证失败:",e),q({title:"请完善表单信息",icon:"error",duration:2e3})}},X=async()=>{try{await L.value.validate(),x({title:"获取中...",mask:!0}),console.log("data",T,N),A({url:T,method:"Get",data:{task:N.task,dataset_name:N.dataset_name}}).then(e=>{if(console.log("request success",e),200!=e.statusCode)return void q({title:"返回数据异常",icon:"error",duration:2e3});q({title:"返回数据成功",icon:"success",duration:2e3});const a=e.data;N.img_name=a.img_name,N.img_dimensions=a.img_dimensions,N.img_path_relative=a.img_path_relative,N.img_size_bytes=a.img_size_bytes}).catch(e=>{console.log("request fail",e),I({content:"请求出错，请稍后再试，谢谢！",showCancel:!1})}).finally(()=>{U()})}catch(e){console.log("表单验证失败:",e),q({title:"请完善表单信息后再试",icon:"error",duration:2e3})}},Y=()=>{L.value.resetFields(),N.seg_target_info={},W()};function Z(){S.value=!0}function ee(){S.value=!1}function ae(e,a,l){const t=e+a+l;return console.log(t),t}function le(e,a){return e.replace(new RegExp(`^${a}|${a}$`,"g"),"")}return(e,a)=>{const l=n(i("up-radio"),d),t=n(i("up-radio-group"),m),s=n(i("up-form-item"),_),o=n(i("up-picker-data"),c),q=n(i("up-icon"),g),x=p,A=n(i("up-input"),f),I=K,U=n(i("up-image"),b),F=n(i("up-button"),v),P=n(i("up-form"),y),j=n(i("up-loading-icon"),h),G=z,T=n(i("up-popup"),k);return C(),r(x,{class:"container"},{default:u(()=>[w(P,{model:N,rules:J,ref_key:"uForm",ref:L,labelPosition:"top",labelWidth:"auto"},{default:u(()=>[w(x,{class:"form-section"},{default:u(()=>[w(s,{label:"推理类型",prop:"task",borderBottom:"",required:""},{default:u(()=>[w(t,{modelValue:N.task,"onUpdate:modelValue":a[0]||(a[0]=e=>N.task=e),onChange:H},{default:u(()=>[w(l,{name:"segmentation",label:"分割"}),w(l,{name:"classification",label:"分类"})]),_:1},8,["modelValue"])]),_:1}),w(s,{label:"身体部位",prop:"dataset_name",borderBottom:"",required:""},{default:u(()=>["segmentation"===N.task?(C(),r(o,{key:0,modelValue:N.dataset_name,"onUpdate:modelValue":a[1]||(a[1]=e=>N.dataset_name=e),options:O.value,title:"点击选择分割身体部位",valueKey:"value",labelKey:"label",style:{width:"100%"},onClick:W},null,8,["modelValue","options"])):(C(),r(o,{key:1,modelValue:N.dataset_name,"onUpdate:modelValue":a[2]||(a[2]=e=>N.dataset_name=e),options:D.value,title:"点击选择分类身体部位",valueKey:"value",labelKey:"label",style:{width:"100%"},onClick:W},null,8,["modelValue","options"])),w(q,{name:"arrow-down",style:{"background-color":"white",height:"45rpx"}})]),_:1})]),_:1}),w(x,{class:"form-section"},{default:u(()=>[w(s,{label:"图像尺寸(宽×高)",prop:"img_dimensions",borderBottom:""},{default:u(()=>[w(x,{class:"dimension-group"},{default:u(()=>[w(A,{modelValue:N.img_dimensions[0],"onUpdate:modelValue":a[3]||(a[3]=e=>N.img_dimensions[0]=e),modelModifiers:{number:!0},type:"number",placeholder:"宽度",class:"dimension-input",border:"none",disabled:""},null,8,["modelValue"]),w(I,{class:"separator"},{default:u(()=>[B("×")]),_:1}),w(A,{modelValue:N.img_dimensions[1],"onUpdate:modelValue":a[4]||(a[4]=e=>N.img_dimensions[1]=e),modelModifiers:{number:!0},type:"number",placeholder:"高度",class:"dimension-input",disabled:"",border:"none"},null,8,["modelValue"])]),_:1})]),_:1}),w(s,{label:"文件大小(B)",prop:"img_size_bytes",borderBottom:""},{default:u(()=>[w(I,null,{default:u(()=>[B(V(N.img_size_bytes),1)]),_:1})]),_:1}),w(x,null,{default:u(()=>[w(U,{"show-loading":!0,src:ae($,le(N.img_path_relative,"data/"),""),mode:"aspectFill"},null,8,["src"])]),_:1})]),_:1}),w(x,{class:"action-buttons"},{default:u(()=>[w(F,{type:"primary",onClick:Q,icon:"checkmark"},{default:u(()=>[B("提交数据")]),_:1}),w(F,{onClick:X,color:"linear-gradient(to right, rgb(66, 83, 216), rgb(213, 51, 186))",icon:"share-square"},{default:u(()=>[B("随机影像")]),_:1}),w(F,{onClick:Y,plain:"",icon:"reload"},{default:u(()=>[B("重置表单")]),_:1})]),_:1})]),_:1},8,["model","rules"]),w(T,{show:S.value,round:10,mode:"top",onClose:ee,onOpen:Z},{default:u(()=>[w(G,{"scroll-y":""},{default:u(()=>[w(x,{class:"page-box"},{default:u(()=>[w(x,{class:"order"},{default:u(()=>[w(x,{class:"toptitle"},{default:u(()=>[w(I,{style:{display:"flex","justify-content":"center"}},{default:u(()=>[B("AI推理结果")]),_:1})]),_:1}),w(x,{class:"top"},{default:u(()=>[w(x,{class:"left"},{default:u(()=>[w(q,{name:"home",size:30,color:"rgb(94,94,94)"}),w(x,{class:"store"},{default:u(()=>[B(V(R(M.value.dataset_name))+"超声影像",1)]),_:1}),w(q,{name:"arrow-right",color:"rgb(203,203,203)",size:26})]),_:1})]),_:1}),w(x,{style:{}},{default:u(()=>[w(I,null,{default:u(()=>[B("原图："+V(R(M.value.dataset_name))+"超声影像",1)]),_:1})]),_:1}),w(x,{class:"item"},{default:u(()=>[w(U,{"show-loading":!0,src:ae($,le(N.img_path_relative,"data/"),""),mode:"aspectFill"},{loading:u(()=>[w(j,{color:"red"})]),_:1},8,["src"])]),_:1}),w(x,{style:{}},{default:u(()=>["segmentation"===N.task?(C(),r(I,{key:0},{default:u(()=>[B("AI分割结果")]),_:1})):(C(),r(I,{key:1},{default:u(()=>[B("AI分类结果")]),_:1}))]),_:1}),w(x,{style:{}},{default:u(()=>[w(U,{"show-loading":!0,src:ae(E,le(M.value.mask_path_relative,"api_out/"),""),mode:"aspectFill"},{loading:u(()=>[w(j,{color:"red"})]),_:1},8,["src"])]),_:1}),w(x,{class:"item"},{default:u(()=>[w(x,{class:"content"},{default:u(()=>[w(x,{class:"number"},{default:u(()=>[B("推理耗时(秒)："+V(M.value.inference_time_sec),1)]),_:1}),w(x,{class:"number"},{default:u(()=>[B("内存占用(MB)："+V(M.value.memory_usage_mb),1)]),_:1}),w(x,{class:"number"},{default:u(()=>[B("显存占用(MB)："+V(M.value.gpu_memory_usage_mb),1)]),_:1}),w(x,{class:"number"},{default:u(()=>[B("分配显存(MB)："+V(M.value.gpu_memory_reserved_mb),1)]),_:1})]),_:1})]),_:1}),w(x,{class:"bottom"},{default:u(()=>[w(F,{type:"primary",onClick:ee,style:{margin:"0",padding:"0"},text:"确定"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])]),_:1})}}},[["__scopeId","data-v-f5b69d12"]]);export{S as default};
