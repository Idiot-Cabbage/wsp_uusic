import{_ as e,r as a,i as l,a as t,o,b as s,g as i,c as n,d as r,e as u,w as d,f as c,h as m,j as _,k as g,l as p,m as f,n as v,p as b,q as y,s as h,t as k,u as w,v as C,x,y as B,z as V,A,B as P,C as q,F as I,D as S,E as U,G as z,H as F,I as K,J as M,K as j,L as E,S as T}from"./index-qbirA_Qb.js";const G=e({__name:"index",setup(e){const G=a(null),N=a(!1),H=a({img_name:"",img_path_relative:"",img_size_bytes:0,img_dimensions:[0,0],img_format:"png",task:"segmentation",dataset_name:"KidneyUS",organ:"Kidney",data_partition_group:"public_all",mask_name:"",mask_path_relative:"",seg_target_info:{},class_label_index:0,class_label_name:"",mask_path_absolute:"",probability:[0,0],prediction:0}),L=uni.$config,O=l("envType"),$=L[O].API_BASE,D=$+"segment2/",J=$+"random_sample/",R=$+"staticdata/",W=$+"staticapi_in/",Q=$+"staticapi_out/",X=t({img_name:"",img_path_relative:"",img_size_bytes:0,img_dimensions:[0,0],img_format:"png",task:"segmentation",dataset_name:"KidneyUS",organ:"Kidney",data_partition_group:"public_all",mask_name:"",mask_path_relative:"",seg_target_info:{},class_label_index:0,class_label_name:""});o(()=>{console.log("onMounted",O,"href",D);try{(function(){const e=i();return console.log("checkPC",e),"windows"===e.platform||"mac"===e.platform?(console.log("PC端"),!0):function(){const e=navigator.userAgent.toLowerCase();return e.includes("windows")||e.includes("macintosh")||e.includes("linux x86_64")?(console.log("当前为电脑端（PC）H5"),!0):(console.log("当前非电脑端H5"),!1)}()})()&&(Y.value="width: 700rpx;")}catch(e){console.log(e)}}),s(()=>{console.log("onActivated")});const Y=a("width: 100%;");a([{value:"png",label:"PNG"},{value:"jpg",label:"JPG"},{value:"dicom",label:"DICOM"},{value:"nii",label:"NIfTI"}]);const Z=a([{value:"BUS-BRA",label:"乳腺"},{value:"CAMUS",label:"心脏"},{value:"Fetal_HC",label:"胎儿头部"},{value:"KidneyUS",label:"肾脏"},{value:"private_Kidney",label:"甲状腺"}]),ee=a([{value:"private_Appendix",label:"阑尾",prediction:{0:"normal",1:"abnormal"}},{value:"BUS-BRA",label:"乳腺",prediction:{0:"benign",1:"maligant"}},{value:"Fatty-Liver",label:"脂肪肝",prediction:{0:"normal",1:"abnormal"}},{value:"private_Breast_luminal",label:"乳腺管腔",prediction:{0:"HER2",1:"Luminal A",2:"Luminal B",3:"Triple Negative"}}]);function ae(e){let a=e.dataset_name,l=[];return l="segmentation"===e.task?Z.value:ee.value,l.forEach(function(e){a!==e.value||(a=e.label)},this),a}function le(e,a){console.log(le);let l=a+"",t=e.dataset_name;return ee.value.forEach(function(e){if(t===e.value)return void 0!==e.prediction?void(l=e.prediction[a]):void(l=a+"")},this),l}a([{value:"public_all",label:"公开全集[public_all]"},{value:"train",label:"训练集[train]"},{value:"val",label:"验证集[val]"},{value:"test",label:"测试集[test]"},{value:"private",label:"私有数据"}]);const te=t({img_name:[{required:!0,message:"图像名称不能为空",trigger:"blur"}],img_format:[{required:!0,pattern:/^(png|jpg|jpeg|dicom|nii)$/i,message:"仅支持PNG/JPG/DICOM/NIfTI格式",trigger:"change"}],task:[{required:!0,message:"请选择任务类型",trigger:"change"}],dataset_name:[{required:!0,message:"器官数据集名称不能为空",trigger:"blur"}],organ:[{required:!0,message:"请选择器官类型",trigger:"change"}]}),oe=e=>{console.log("groupChangeTask",e),X.dataset_name="segmentation"===e?"KidneyUS":"private_Appendix",se()},se=()=>{console.log("clearImage"),X.img_name="",X.img_dimensions=[],X.img_path_relative="",X.img_size_bytes=""},ie=async()=>{try{if(await G.value.validate(),X.img_dimensions[0]<=0)return void S({title:"请点随机影响，获取一张图片",icon:"error",duration:2e3});U({title:"提交中...",mask:!0}),console.log("data",D,X),z({url:D,method:"POST",data:X}).then(e=>{console.log("request success",e),200==e.statusCode?(S({title:"返回数据成功",icon:"success",duration:2e3}),H.value=e.data||{},N.value=!0):S({title:"返回数据异常",icon:"error",duration:2e3})}).catch(e=>{console.log("request fail",e),F({content:"请求出错，请稍后再试，谢谢！",showCancel:!1})}).finally(()=>{K()})}catch(e){console.log("表单验证失败:",e),S({title:"请完善表单信息",icon:"error",duration:2e3})}},ne=async()=>{try{await G.value.validate(),U({title:"获取中...",mask:!0}),console.log("data",J,X),z({url:J,method:"Get",data:{task:X.task,dataset_name:X.dataset_name}}).then(e=>{if(console.log("request success",e),200!=e.statusCode)return void S({title:"返回数据异常",icon:"error",duration:2e3});S({title:"返回数据成功",icon:"success",duration:2e3});const a=e.data;X.img_name=a.img_name,X.img_dimensions=a.img_dimensions,X.img_path_relative=a.img_path_relative,X.img_size_bytes=a.img_size_bytes}).catch(e=>{console.log("request fail",e),F({content:"请求出错，请稍后再试，谢谢！",showCancel:!1})}).finally(()=>{K()})}catch(e){console.log("表单验证失败:",e),S({title:"请完善表单信息后再试",icon:"error",duration:2e3})}},re=()=>{G.value.resetFields(),X.seg_target_info={},se()};function ue(){N.value=!0}function de(){N.value=!1}function ce(e,a,l){const t=e+a+l;return console.log(t),t}function me(e,a){return e.replace(new RegExp(`^${a}|${a}$`,"g"),"")}function _e(e){console.log("uploadimage");const a=me($,"/")+"/upload";console.log("uploadimage","uploadurl",a),M({success:e=>{const l=e.tempFilePaths;console.log("tempFilePaths",l),U({title:"上传中...",mask:!0});j({url:a,filePath:l[0],name:"file",formData:{user:"test"},success:e=>{if(K(),console.log(e),200!=e.statusCode)return void S({title:"上传文件失败",icon:"error",duration:2e3});S({title:"上传文件成功",icon:"success",duration:2e3});const a=JSON.parse(e.data);console.log(a),X.img_name=a.img_name,X.img_dimensions=a.img_dimensions,X.img_path_relative=a.img_path_relative,X.img_size_bytes=a.img_size_bytes},fail:e=>{K(),console.log("上传文件失败:",e),S({title:"上传文件失败",icon:"error",duration:2e3})}}).onProgressUpdate(e=>{console.log("上传进度"+e.progress),console.log("已经上传的数据长度"+e.totalBytesSent),console.log("预期需要上传的数据总长度"+e.totalBytesExpectedToSend)})},fail:e=>{K(),console.log("上传文件失败:",e),S({title:"上传文件失败",icon:"error",duration:2e3})}})}return a([]),(e,a)=>{const l=n(r("up-radio"),c),t=n(r("up-radio-group"),m),o=n(r("up-form-item"),_),s=n(r("up-picker-data"),g),i=n(r("up-icon"),p),S=f,U=n(r("up-input"),v),z=E,F=n(r("up-image"),b),K=n(r("up-button"),y),M=n(r("up-form"),h),j=n(r("up-loading-icon"),k),L=T,O=n(r("up-popup"),w);return C(),u(S,{style:{display:"flex","justify-content":"center"}},{default:d(()=>[x(S,{class:"container",style:A(Y.value)},{default:d(()=>[x(M,{model:X,rules:te,ref_key:"uForm",ref:G,labelPosition:"top",labelWidth:"auto"},{default:d(()=>[x(S,{class:"form-section"},{default:d(()=>[x(o,{label:"推理类型",prop:"task",borderBottom:"",required:""},{default:d(()=>[x(t,{modelValue:X.task,"onUpdate:modelValue":a[0]||(a[0]=e=>X.task=e),onChange:oe},{default:d(()=>[x(l,{name:"segmentation",label:"分割"}),x(l,{name:"classification",label:"分类"})]),_:1},8,["modelValue"])]),_:1}),x(o,{label:"身体部位",prop:"dataset_name",borderBottom:"",required:""},{default:d(()=>["segmentation"===X.task?(C(),u(s,{key:0,modelValue:X.dataset_name,"onUpdate:modelValue":a[1]||(a[1]=e=>X.dataset_name=e),options:Z.value,title:"点击选择分割身体部位",valueKey:"value",labelKey:"label",style:{width:"100%"},onClick:se},null,8,["modelValue","options"])):(C(),u(s,{key:1,modelValue:X.dataset_name,"onUpdate:modelValue":a[2]||(a[2]=e=>X.dataset_name=e),options:ee.value,title:"点击选择分类身体部位",valueKey:"value",labelKey:"label",style:{width:"100%"},onClick:se},null,8,["modelValue","options"])),x(i,{name:"arrow-down",style:{"background-color":"white",height:"45rpx"}})]),_:1})]),_:1}),x(S,{class:"form-section"},{default:d(()=>[x(o,{label:"图像尺寸(宽×高)",prop:"img_dimensions",borderBottom:""},{default:d(()=>[x(S,{class:"dimension-group"},{default:d(()=>[x(U,{modelValue:X.img_dimensions[0],"onUpdate:modelValue":a[3]||(a[3]=e=>X.img_dimensions[0]=e),modelModifiers:{number:!0},type:"number",placeholder:"宽度",class:"dimension-input",border:"none",disabled:""},null,8,["modelValue"]),x(z,{class:"separator"},{default:d(()=>[B("×")]),_:1}),x(U,{modelValue:X.img_dimensions[1],"onUpdate:modelValue":a[4]||(a[4]=e=>X.img_dimensions[1]=e),modelModifiers:{number:!0},type:"number",placeholder:"高度",class:"dimension-input",disabled:"",border:"none"},null,8,["modelValue"])]),_:1})]),_:1}),x(o,{label:"文件大小(B)",prop:"img_size_bytes",borderBottom:""},{default:d(()=>[x(z,null,{default:d(()=>[B(V(X.img_size_bytes),1)]),_:1})]),_:1}),x(S,null,{default:d(()=>[X.img_path_relative.startsWith("data/")?(C(),u(F,{key:0,"show-loading":!0,src:ce(R,me(X.img_path_relative,"data/"),""),mode:"aspectFill"},null,8,["src"])):(C(),u(F,{key:1,"show-loading":!0,src:ce(W,me(X.img_path_relative,"api_in/"),""),mode:"aspectFill"},null,8,["src"]))]),_:1})]),_:1}),x(S,{class:"action-buttons"},{default:d(()=>[x(K,{type:"primary",onClick:ie,icon:"checkmark"},{default:d(()=>[B("提交数据")]),_:1}),x(K,{onClick:ne,color:"linear-gradient(to right, rgb(66, 83, 216), rgb(213, 51, 186))",icon:"share-square"},{default:d(()=>[B("随机影像")]),_:1}),x(K,{onClick:re,plain:"",icon:"reload"},{default:d(()=>[B("重置表单")]),_:1})]),_:1}),x(S,null,{default:d(()=>[x(K,{onClick:_e,plain:"",icon:"photo"},{default:d(()=>[B("上传影像图片")]),_:1})]),_:1})]),_:1},8,["model","rules"]),x(O,{show:N.value,round:10,mode:"top",onClose:de,onOpen:ue},{default:d(()=>[x(L,{"scroll-y":""},{default:d(()=>[x(S,{style:{display:"flex","justify-content":"center"}},{default:d(()=>[x(S,{class:"page-box",style:A(Y.value)},{default:d(()=>[x(S,{class:"order"},{default:d(()=>[x(S,{class:"toptitle"},{default:d(()=>[x(z,{style:{display:"flex","justify-content":"center"}},{default:d(()=>[B("AI推理结果")]),_:1})]),_:1}),x(S,{class:"top"},{default:d(()=>[x(S,{class:"left"},{default:d(()=>[x(i,{name:"home",size:30,color:"rgb(94,94,94)"}),x(S,{class:"store"},{default:d(()=>[B(V(ae(H.value))+"超声影像",1)]),_:1}),x(i,{name:"arrow-right",color:"rgb(203,203,203)",size:26})]),_:1})]),_:1}),x(S,{style:{}},{default:d(()=>[x(z,null,{default:d(()=>[B("原图："+V(ae(H.value))+"超声影像",1)]),_:1})]),_:1}),x(S,{class:"item"},{default:d(()=>[X.img_path_relative.startsWith("data/")?(C(),u(F,{key:0,"show-loading":!0,src:ce(R,me(X.img_path_relative,"data/"),""),mode:"aspectFill"},{loading:d(()=>[x(j,{color:"red"})]),_:1},8,["src"])):(C(),u(F,{key:1,"show-loading":!0,src:ce(W,me(X.img_path_relative,"api_in/"),""),mode:"aspectFill"},{loading:d(()=>[x(j,{color:"red"})]),_:1},8,["src"]))]),_:1}),x(S,{style:{}},{default:d(()=>["segmentation"===X.task?(C(),u(z,{key:0},{default:d(()=>[B("AI分割结果")]),_:1})):(C(),u(z,{key:1},{default:d(()=>[B("AI分类结果")]),_:1}))]),_:1}),x(S,{style:{}},{default:d(()=>["segmentation"===X.task?(C(),u(F,{key:0,"show-loading":!0,src:ce(Q,me(H.value.mask_path_relative,"api_out/"),""),mode:"aspectFill"},{loading:d(()=>[x(j,{color:"red"})]),_:1},8,["src"])):(C(),u(S,{key:1},{default:d(()=>[(C(!0),P(I,null,q(H.value.probability,(e,a)=>(C(),u(S,{class:"number"},{default:d(()=>[B(" 概率("+V(le(H.value,a))+")："+V(e),1)]),_:2},1024))),256)),x(S,{class:"title up-line-2"},{default:d(()=>[B(" 推测结果: "+V(le(H.value,H.value.prediction)),1)]),_:1})]),_:1}))]),_:1}),x(S,{class:"item"},{default:d(()=>[x(S,{class:"content"},{default:d(()=>[x(S,{class:"number"},{default:d(()=>[B("推理耗时(秒)："+V(H.value.inference_time_sec),1)]),_:1}),x(S,{class:"number"},{default:d(()=>[B("内存占用(MB)："+V(H.value.memory_usage_mb),1)]),_:1}),x(S,{class:"number"},{default:d(()=>[B("显存占用(MB)："+V(H.value.gpu_memory_usage_mb),1)]),_:1}),x(S,{class:"number"},{default:d(()=>[B("分配显存(MB)："+V(H.value.gpu_memory_reserved_mb),1)]),_:1})]),_:1})]),_:1}),x(S,{class:"bottom"},{default:d(()=>[x(K,{type:"primary",onClick:de,style:{margin:"0",padding:"0"},text:"确定"})]),_:1})]),_:1})]),_:1},8,["style"])]),_:1})]),_:1})]),_:1},8,["show"])]),_:1},8,["style"])]),_:1})}}},[["__scopeId","data-v-42f24eba"]]);export{G as default};
